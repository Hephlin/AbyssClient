package me.ciruu.abyss.modules.exploit;

import java.util.Comparator;
import java.util.function.Predicate;
import me.ciruu.abyss.util.Timer;
import me.ciruu.abyss.Globals;
import me.ciruu.abyss.enums.Category;
import me.ciruu.abyss.events.player.EventPlayerUpdate;
import me.ciruu.abyss.modules.Module;
import me.ciruu.abyss.settings.Setting;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import net.minecraft.block.Block;
import net.minecraft.block.BlockChest;
import net.minecraft.client.gui.inventory.GuiScreenHorseInventory;
import net.minecraft.entity.Entity;
import net.minecraft.entity.passive.AbstractChestHorse;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.init.Items;
import net.minecraft.inventory.ClickType;
import net.minecraft.item.ItemBlock;
import net.minecraft.item.ItemShulkerBox;
import net.minecraft.item.ItemStack;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketUseEntity;
import net.minecraft.util.EnumHand;
import net.minecraftforge.event.entity.EntityJoinWorldEvent;

public class AutoMountDupe
extends Module {
    public final Setting shulkeronly = new Setting("ShulkerOnly", "", this, true);
    public final Setting hitground = new Setting("HitGround", "", this, true);
    private final Setting delay = new Setting("Delay", "", (Module)this, (Object)Float.valueOf(1.0f), Float.valueOf(0.0f), Float.valueOf(10.0f));
    private boolean Field2942 = false;
    private boolean Field2943 = false;
    private boolean Field2944 = false;
    private boolean Field2945 = false;
    private boolean Field2946 = false;
    private boolean Field2947 = false;
    private int Field2948;
    private int Field2949;
    private int Field2950;
    private GuiScreenHorseInventory Field2951;
    private final Timer Field2952 = new Timer();
    private boolean Field2953 = false;
    @EventHandler
    private final Listener Field2954 = new Listener<EventPlayerUpdate>(this::addSetting38, new Predicate[0]);
    @EventHandler
    private final Listener Field2955 = new Listener<EntityJoinWorldEvent>(this::addSetting39, new Predicate[0]);

    public AutoMountDupe() {
        super("AutoMountDupe", "", Category.EXPLOIT, "");
        this.addSetting(this.shulkeronly);
        this.addSetting(this.hitground);
        this.addSetting(this.delay);
    }

    public boolean getEnable() {
        super.getEnable();
        this.Field2952.reset();
        this.Field2945 = true;
        return false;
    }

    public void getDisable() {
        super.getDisable();
        this.Field2953 = false;
        this.Field2942 = false;
        this.Field2943 = false;
        this.Field2944 = false;
        this.Field2945 = false;
        this.Field2946 = false;
        this.Field2947 = false;
        this.Field2948 = 0;
        this.Field2949 = 0;
        this.Field2950 = 0;
        this.Field2952.reset();
    }

    private boolean addSetting43(Entity entity) {
        if (entity instanceof AbstractChestHorse) {
            AbstractChestHorse abstractChestHorse = (AbstractChestHorse)entity;
            return !abstractChestHorse.isChild() && abstractChestHorse.isTame();
        }
        return false;
    }

    private int addSetting44() {
        for (int i = 0; i < 9; ++i) {
            Block block;
            ItemStack itemStack = Globals.mc.player.inventory.getStackInSlot(i);
            if (itemStack == ItemStack.EMPTY || !(itemStack.getItem() instanceof ItemBlock) || !((block = ((ItemBlock)itemStack.getItem()).getBlock()) instanceof BlockChest)) continue;
            return i;
        }
        return -1;
    }

    private void addSetting45(int n, int n2) {
        for (int i = 9; i < Globals.mc.player.inventoryContainer.inventorySlots.size() - 1; ++i) {
            ItemStack itemStack = Globals.mc.player.inventoryContainer.getSlot(i).getStack();
            if (itemStack.isEmpty() || itemStack.getItem() == Items.AIR || !(itemStack.getItem() instanceof ItemShulkerBox) && ((Boolean)this.shulkeronly.getValue()).booleanValue()) continue;
            Globals.mc.playerController.windowClick(n, i + n2, 0, ClickType.QUICK_MOVE, (EntityPlayer)Globals.mc.player);
            return;
        }
    }

    private void addSetting46() {
        this.Field2953 = true;
        Entity entity = Globals.mc.world.loadedEntityList.stream().filter(this::addSetting43).min(Comparator.comparing(AutoMountDupe::addSetting47)).orElse(null);
        if (entity instanceof AbstractChestHorse) {
            Globals.mc.player.connection.sendPacket((Packet)new CPacketUseEntity(entity, EnumHand.MAIN_HAND, entity.getPositionVector()));
            this.Field2953 = false;
            this.Field2942 = true;
        }
    }

    private int addSetting48() {
        return 0;
    }

    private int addSetting49() {
        return 0;
    }

    private boolean addSetting50() {
        for (int i = 9; i < Globals.mc.player.inventoryContainer.inventorySlots.size() - 1; ++i) {
            ItemStack itemStack = Globals.mc.player.inventoryContainer.getSlot(i).getStack();
            if (!itemStack.isEmpty() && itemStack.getItem() != Items.AIR) continue;
            return true;
        }
        return false;
    }

    public boolean Method460() {
        return this.Field2953;
    }

    private static Float addSetting47(Entity entity) {
        return Float.valueOf(Globals.mc.player.getDistance(entity));
    }

    private void addSetting39(EntityJoinWorldEvent entityJoinWorldEvent) {
    }

    private void addSetting38(EventPlayerUpdate eventPlayerUpdate) {
    }

    private static Float addSetting53(Entity entity) {
        return Float.valueOf(Globals.mc.player.getDistance(entity));
    }
}
